<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minecraft Server Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div id="app" class="container-fluid min-vh-100 d-flex align-items-center justify-content-center">
  <div class="card-container animate-fade">
    <div class="header text-center mb-3">
      <div class="title-row d-flex align-items-center justify-content-center">
        <div class="server-icon">üóÑÔ∏è</div>
        <h1 class="title ms-2">Minecraft Server Dashboard</h1>
      </div>
      <div class="subtitle text-muted">Live-Status und Spieler√ºbersicht (Deutsch)</div>
    </div>

    <div class="status-grid">
      <div class="status-indicator">
        <div class="indicator-circle" id="status-circle"></div>
        <div>
          <div class="label">Status:</div>
          <div id="status-text" class="value">lade‚Ä¶</div>
        </div>
      </div>

      <div class="uptime-box">
        <div class="label">Uptime:</div>
        <div id="uptime" class="value">‚Äì</div>
      </div>
    </div>

    <div class="mt-3 players-section">
      <div class="section-header d-flex align-items-center mb-2">
        <div class="icon">üë•</div>
        <h2 class="ms-2">Spieler online:</h2>
      </div>
      <div id="players-list" class="list-group mb-3"></div>
    </div>

    <div class="sessions-section mt-2">
      <div class="section-header d-flex align-items-center mb-2">
        <div class="icon">‚è±Ô∏è</div>
        <h2 class="ms-2">Heute online gewesen:</h2>
      </div>
      <div id="sessions-list" class="list-group"></div>
    </div>

    <div class="footer mt-3 pt-3 text-center">
      <div id="last-update" class="text-muted small">Letztes Update: ‚Äì</div>
      <div class="text-muted xsmall">Automatisch aktualisiert alle 10 Sekunden</div>
    </div>
  </div>
</div>

<script>
async function fetchStatus() {
  try {
    const res = await fetch('/api/online');
    if (!res.ok) return;
    const data = await res.json();

    // status
    document.getElementById('status-text').textContent = data.status_text || '‚Äì';
    const circle = document.getElementById('status-circle');
    circle.style.boxShadow = data.color ? `0 0 30px ${data.color}33` : '';
    circle.style.background = data.color || '#888';

    // uptime
    document.getElementById('uptime').textContent = data.uptime || '‚Äì';

    // last update
    document.getElementById('last-update').textContent =
      'üïí Letztes Update: ' + (data.last_update || '‚Äì');

    // players
    const playersList = document.getElementById('players-list');
    playersList.innerHTML = '';
    if (!data.players || data.players.length === 0) {
      const li = document.createElement('div');
      li.className = 'list-group-item muted';
      li.textContent = 'Niemand online';
      playersList.appendChild(li);
    } else {
      data.players.forEach(p => {
        const li = document.createElement('div');
        li.className = 'list-group-item player-item d-flex align-items-center';
        li.innerHTML = `<span class="dot online"></span><span class="player-name ms-2">${p}</span>`;
        playersList.appendChild(li);
      });
    }

    // sessions
    const sessionsList = document.getElementById('sessions-list');
    sessionsList.innerHTML = '';
    const sessions = data.sessions || {};
    const keys = Object.keys(sessions);
    if (keys.length === 0) {
      const li = document.createElement('div');
      li.className = 'list-group-item muted';
      li.textContent = 'Noch keine Aktivit√§t heute';
      sessionsList.appendChild(li);
    } else {
      for (const player of keys) {
        const info = sessions[player];
        const sessionDiv = document.createElement('div');
        sessionDiv.className = 'list-group-item session-card';
        const header = document.createElement('div');
        header.className = 'session-header d-flex justify-content-between';
        const nameSpan = document.createElement('div');
        nameSpan.innerHTML = `<strong>‚Ä¢ ${player}</strong>`;
        const totalSec = info.total_seconds || 0;
        const totalStr = Math.floor(totalSec/3600) + 'h ' + Math.floor((totalSec%3600)/60) + 'm';
        const totalSpan = document.createElement('div');
        totalSpan.className = 'total-time';
        totalSpan.textContent = totalStr;
        header.appendChild(nameSpan);
        header.appendChild(totalSpan);
        sessionDiv.appendChild(header);

        // session list
        const listEl = document.createElement('div');
        listEl.className = 'session-list';
        (info.sessions || []).forEach(s => {
          const start = new Date(s.start);
          const end = s.end ? new Date(s.end) : null;
          const startStr = start.toLocaleTimeString('de-DE', {hour:'2-digit',minute:'2-digit'});
          const endStr = end ? end.toLocaleTimeString('de-DE', {hour:'2-digit',minute:'2-digit'}) : 'jetzt';
          const p = document.createElement('div');
          p.className = 'session-item';
          p.textContent = `‚Üí ${startStr}‚Äì${endStr}`;
          listEl.appendChild(p);
        });
        sessionDiv.appendChild(listEl);
        sessionsList.appendChild(sessionDiv);
      }
    }

  } catch (err) {
    console.error("Fehler beim Laden:", err);
  }
}

fetchStatus();
setInterval(fetchStatus, 10000);
</script>
</body>
</html>
